# 代币大户分析Bot

这是一个Telegram机器人，用于分析代币的大户持仓情况和价格变动监控。

## 主要功能

### 🔍 代币大户分析 (`/ca1`)
- 分析指定代币的大户持仓分布
- 支持地址集群分析
- 可按不同维度排序查看
- 提供详细的持仓统计信息
- **🚀 多线程加速**: 并发获取钱包资产，提升67%分析速度

### 🔥 自动Pump分析 (`/capump`) - 新功能
- 自动监控价格异动超过10%的代币
- 对符合条件的代币自动进行大户分析
- 支持启用/关闭自动分析模式
- 智能过滤黑名单代币
- **⚡ 智能并发**: 多线程处理，快速完成批量分析

### 📊 价格变动监控
- 实时监控代币价格变化
- 自动推送涨幅预警
- 可配置监控阈值和条件

### ⚙️ 配置管理 (`/config`)
- 动态调整监控参数
- 黑名单管理
- 权限控制

## 使用方法

### 基本命令

```
/help - 显示帮助信息
/ca1 <代币地址> - 分析指定代币大户
/capump - 查看自动pump分析状态
/capump on - 启用自动pump分析
/capump off - 关闭自动pump分析
/config - 打开配置界面
```

### 自动Pump分析功能

自动pump分析是新增的功能，可以：
- 自动检测涨幅超过10%的代币
- 自动对这些代币进行大户持仓分析
- 将分析结果发送到群组
- 避免重复分析同一代币
- 智能跳过黑名单代币

启用方法：
```
/capump on
```

关闭方法：
```
/capump off
```

查看状态：
```
/capump
```

## 功能特点

- **智能缓存**: 避免重复分析，提高效率
- **权限控制**: 仅在授权群组中使用
- **黑名单过滤**: 自动跳过黑名单代币
- **多线程处理**: 每个群组独立的分析线程
- **错误恢复**: 网络错误自动重试
- **数据持久化**: 重启后自动恢复分析状态
- **健康监控**: HTTP健康检查接口
- **智能日志**: 详细错误分析和解决方案

## 性能优化

### 多线程加速
- **并发获取**: 使用多线程并发获取钱包资产信息
- **智能调度**: 自动分配任务，最大化资源利用率  
- **速率控制**: 内置频率限制，避免API限制
- **配置灵活**: 可调整并发线程数（默认5个）

配置示例：
```json
{
  "analysis": {
    "max_concurrent_threads": 5,
    "top_holders_count": 100
  }
}
```

### 性能对比
| 模式 | 处理时间 | 性能提升 |
|------|----------|----------|
| 单线程 | 25.4秒 | - |
| 多线程 | 8.3秒 | **67.3% ↑** |

详细说明请参考：[多线程优化指南](docs/MULTITHREADING_GUIDE.md)

## 安装和配置

1. 克隆项目
2. 安装依赖：`pip install -r requirements.txt`
3. 配置 `config/config.json`（参考 `config/config.example.json`）
4. 运行：`python main.py` 或 `python production_start.py`

详细配置说明请参考 `config/config.example.json`。

## 健康检查和监控

### 启用健康检查
设置环境变量：`ENABLE_HEALTH_CHECK=true`

### 监控端点
- **基础检查**: `http://localhost:8080/health`
- **详细状态**: `http://localhost:8080/status`
- **系统指标**: `http://localhost:8080/metrics`

### 日志系统
- **主日志**: `storage/logs/模块名_YYYYMMDD.log`
- **错误日志**: `storage/logs/模块名_error_YYYYMMDD.log`
- **解决方案**: `storage/logs/模块名_solutions_YYYYMMDD.log`

### 功能演示
运行演示脚本查看增强功能：
```bash
python demo_enhanced_features.py
```

## 故障排除

### 常见问题和解决方案

**Bot无法启动**
- 检查Telegram Token是否正确
- 确认网络连接正常
- 查看错误日志获取详细信息

**分析功能不可用**
- 检查API服务状态
- 确认代理设置正确
- 验证代币地址格式

**性能问题**
- 调整并发数量
- 检查网络延迟
- 监控系统资源使用

**权限错误**
- 检查文件和目录权限
- 确认Bot在授权群组中
- 验证管理员权限

## 注意事项

- 自动分析功能会消耗一定的API资源
- 建议合理使用黑名单功能
- 数据文件存储在 `storage/` 目录
- 分析状态保存在 `storage/config/auto_pump_status.json`
- 定期检查日志文件以监控系统状态

## 更新日志

### v2.2.0 (2025-08-19) - 最新
- 🚀 **新增多线程支持**: OKX爬虫支持并发获取钱包资产
- ⚡ **性能大幅提升**: 分析速度提升67%（3.1倍加速）
- 🔧 **智能速率控制**: 内置频率限制和重试机制
- 📊 **实时进度监控**: 显示处理进度和预计剩余时间
- ⚙️ **配置灵活**: 支持自定义并发线程数
- 🛡️ **稳定可靠**: 完善的错误处理和超时保护

### v2.1.0
- 🏥 新增健康检查系统
- 📖 完善帮助和文档系统
- 🔧 增强错误处理和解决方案
- 📊 改进日志系统和监控
- 🛡️ 增强异常恢复机制
- 📈 添加性能监控和API调用跟踪

### v2.0.0
- 新增自动pump分析功能 (`/capump`)
- 支持多群组独立分析
- 增强错误处理和恢复机制
- 优化性能和资源使用

### v1.x.x
- 基础大户分析功能
- 价格监控功能
- 配置管理功能