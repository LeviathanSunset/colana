# 🤖 代币大户分析Bot - 功能文档

## 📋 项目概述

本项目是一个基于Telegram的代币大户分析Bot，专门用于分析Solana链上代币的大户持仓情况。通过OKX Web3 API获取数据，为用户提供详细的大户持仓分析和代币热度排行榜。

---

## 🚀 核心大功能

### 1. 🔍 代币大户持仓分析 (`/ca1`)

- **功能描述**：分析指定代币的大户持仓情况，生成详细的持仓报告
- **实现原理**：
  1. 获取代币持有者排行榜（前N个大户）
  2. 逐一分析每个大户的完整资产组合
  3. 统计所有大户持有的代币种类和价值
  4. 生成按价值/人数排序的代币热度排行榜

### 2. 📊 代币热度排行榜

- **功能描述**：展示大户最喜欢持有的代币排行榜
- **排序方式**：
  - 💰 按总价值排序：显示大户持有总价值最高的代币
  - 👥 按持有人数排序：显示被最多大户持有的代币
- **数据展示**：代币名称、持有价值、持有人数、实时超链接

### 3. 🪙 代币详情查看

- **功能描述**：查看特定代币的大户持有详情
- **详细信息**：
  - 代币基本信息（名称、总价值、持有人数）
  - 大户持有排行（按持有价值排序）
  - 每个大户的持有数量和价值
  - 大户地址的GMGN链接

### 4. ⚙️ 配置管理系统

- **功能描述**：Bot参数的动态配置和管理
- **配置项目**：
  - `INTERVAL`：监控间隔时间
  - `THRESHOLD`：涨幅阈值
  - `MIN_MARKET_CAP`：最小市值
  - `MIN_AGE_DAYS`：最小代币年龄
  - `TOP_HOLDERS_COUNT`：分析的大户数量
- **管理功能**：实时修改、立即生效、配置持久化

### 5. 🚫 黑名单管理

- **功能描述**：管理不需要分析的代币地址
- **操作功能**：
  - ➕ 添加黑名单：将代币地址加入黑名单
  - ➖ 移除黑名单：从黑名单中移除代币
  - 📋 查看黑名单：显示当前所有黑名单项目
- **数据持久化**：黑名单数据保存在JSON文件中

---

## 🛠️ 详细小功能

### 🔗 超链接功能

1. **代币名称链接**：
   - 格式：`https://gmgn.ai/sol/token/{token_address}`
   - 功能：点击代币名称直接跳转到GMGN查看代币详情

2. **大户地址链接**：
   - 格式：`https://gmgn.ai/sol/address/{wallet_address}`
   - 功能：点击大户地址查看钱包详细持仓
   - 显示：简化地址格式 `xxxxx...xxxx 🔗`

### 📱 交互式按钮系统

1. **排序切换按钮**：
   - 💰 按价值排序 / 👥 按人数排序
   - 实时切换，保持数据缓存
   - 当前排序状态用 ✅ 标记

2. **代币详情按钮**：
   - 为排行榜前10个代币生成详情按钮
   - 格式：`1. SOL 大户` `2. USDC 大户`
   - 每行最多3个按钮，自动换行

3. **返回导航按钮**：
   - ⬅️ 返回排行榜：从详情页返回排行榜
   - ⬅️ 返回配置：配置子菜单返回主菜单

### 💾 数据缓存系统

1. **24小时缓存**：
   - 分析结果缓存24小时
   - 自动清理过期缓存
   - 缓存键格式：`{chat_id}_{message_id}`

2. **数据过期处理**：
   - 检测数据是否过期
   - 提供🔄重新分析按钮
   - 自动重新获取最新数据

### 📈 数据格式化

1. **价值格式化**：
   - `$1,000,000+` → `$1.0M`
   - `$1,000+` → `$1.0K`
   - 小于$1000显示原值

2. **数量格式化**：
   - `1,000,000+` → `1.0M`
   - `1,000+` → `1.0K`
   - 自动千分位分隔

3. **地址简化显示**：
   - 完整地址：`9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM`
   - 简化显示：`9WzDXw...AWWM`

### 🔄 后台处理系统

1. **多线程分析**：
   - 分析任务在后台线程运行
   - 不阻塞Bot主线程
   - 实时更新分析进度

2. **错误处理**：
   - 网络错误自动重试
   - API限制智能等待
   - 详细错误日志记录

### 📝 日志系统

1. **分析日志**：
   - 详细的分析过程记录
   - 保存在 `okx_log/` 目录
   - 按日期自动分割日志文件

2. **结果保存**：
   - JSON格式保存分析结果
   - 文件名包含代币地址和时间戳
   - 便于后续数据分析和调试

---

## 📊 使用流程示例

### 基本分析流程

```text
1. 用户发送: /ca1 FbGsCHv8qPvUdmomVAiG72ET5D5kgBJgGoxxfMZipump
2. Bot开始分析: "🔍 正在分析代币大户持仓..."
3. 后台获取前100个大户信息
4. 逐一分析每个大户的完整持仓
5. 统计所有大户持有的代币
6. 生成排行榜（默认按人数排序）
7. 显示结果和交互按钮
```

### 交互操作流程

```text
排行榜页面:
├── 点击 [💰 按价值排序] → 切换到价值排序
├── 点击 [👥 按人数排序] → 切换到人数排序
├── 点击 [1. SOL 大户] → 查看SOL详情
└── 点击代币名称链接 → 跳转到GMGN

详情页面:
├── 查看大户持有排行
├── 点击大户地址链接 → 跳转到GMGN查看钱包
└── 点击 [⬅️ 返回排行榜] → 返回主页面
```

---

## ⚙️ 配置说明

### 主要配置参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `TOP_HOLDERS_COUNT` | 100 | 分析的大户数量 |
| `INTERVAL` | 58 | 监控间隔（秒） |
| `THRESHOLD` | 0.05 | 涨幅阈值 |
| `MIN_MARKET_CAP` | 0 | 最小市值 |
| `MIN_AGE_DAYS` | 10 | 最小代币年龄（天） |

### 性能建议

- **大户数量**：建议10-30个，平衡速度和完整性
- **分析时间**：每个大户约需1-2秒，100个大户约需2-3分钟
- **网络要求**：稳定的网络连接，支持访问OKX API

---

## 🔧 技术架构

### 核心组件

1. **`bot.py`** - Telegram Bot主程序
2. **`handlers.py`** - 命令和回调处理逻辑
3. **`okx_crawler.py`** - OKX API数据爬取和分析
4. **`config.py`** - 配置参数管理
5. **`blacklist.py`** - 黑名单管理功能

### 数据流程

```text
### 数据流程

```mermaid
用户输入 → Telegram Bot → 命令解析 → OKX API调用 → 数据分析 → 结果格式化 → 用户界面
```
```

### API依赖

- **OKX Web3 API**：获取代币持有者和钱包资产数据
- **Telegram Bot API**：用户交互和消息推送
- **GMGN.ai**：代币和钱包详情链接

---

## 📱 用户界面设计

### 命令列表

- `/start` 或 `/help` - 显示帮助信息
- `/config` - 配置管理界面
- `/ca1 <token_address>` - 分析代币大户
- `/topicid` - 获取当前topic ID

### 界面特色

1. **富文本格式**：使用HTML格式化，支持粗体、链接等
2. **交互按钮**：丰富的inline keyboard交互
3. **实时反馈**：操作即时响应和状态更新
4. **错误处理**：友好的错误提示和重试机制

---

## 🎯 核心优势

1. **🚀 高效分析**：多线程处理，支持大量大户并发分析
2. **📊 数据丰富**：不仅分析目标代币，还分析大户的完整持仓
3. **🔄 实时交互**：排序切换、详情查看、一键刷新
4. **🔗 无缝跳转**：集成GMGN链接，一键查看详细信息
5. **⚙️ 灵活配置**：所有参数可在线调整，适应不同需求
6. **💾 智能缓存**：24小时缓存机制，避免重复分析
7. **📝 详细日志**：完整的操作日志，便于问题追踪

这个Bot为代币投资者提供了一个强大的大户分析工具，帮助用户发现大户关注的热门代币，做出更明智的投资决策。

---

## 🚀 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 配置Bot

1. 修改 `config.py` 中的配置参数
2. 设置Telegram Bot Token
3. 配置目标群组ID

### 运行Bot

```bash
python bot.py
```

### 使用示例

```bash
/ca1 FbGsCHv8qPvUdmomVAiG72ET5D5kgBJgGoxxfMZipump
```

---

## 📞 技术支持

如有问题或建议，请通过以下方式联系：

- **项目维护**：定期更新和功能增强
- **错误报告**：详细的日志记录便于问题诊断
- **功能建议**：欢迎提出新功能需求

---

## 📄 许可证

本项目仅供学习和研究使用，请遵守相关法律法规和API使用条款。
